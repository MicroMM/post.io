<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>MicroPost.inc</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 800px; 
            margin: 20px auto; 
            padding: 20px; 
            background: #f4f4f4; 
            color: #FFA500; /* Orange for general text */
        }
        h1 { 
            text-align: left; /* Left-aligned title */
            margin-bottom: 10px; 
        }
        h2 { 
            color: #000000; /* Black for subheadings */
        }
        .container { 
            background: white; 
            padding: 20px; 
            border-radius: 8px; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.1); 
        }
        .input-group { 
            margin-bottom: 15px; 
            display: flex; 
            justify-content: flex-end; /* Align search to the right */
        }
        .input-group label { 
            display: block; 
            margin-bottom: 5px; 
            font-weight: bold; 
            color: #000000; /* Black for labels */
        }
        input, textarea { 
            width: 100%; 
            padding: 8px; 
            border: 1px solid #ddd; 
            border-radius: 4px; 
            box-sizing: border-box; 
            color: #FFA500; /* Orange for input text */
        }
        button { 
            background: #007BFF; 
            color: white; 
            padding: 10px 20px; 
            border: none; 
            border-radius: 4px; 
            cursor: pointer; 
        }
        button:hover { 
            background: #0056b3; 
        }
        #posts { 
            margin-top: 20px; 
        }
        .post { 
            padding: 15px; 
            border-bottom: 1px solid #ddd; 
            background: #fafafa; 
            border-radius: 4px; 
            margin-bottom: 10px; 
            color: #FFA500; /* Orange for post content */
        }
        .location { 
            font-size: 0.9em; 
            color: #FFA500; /* Orange for location */
        }
        #authContainer { 
            display: none; 
            margin-top: 20px; 
        }
        #createPostBtn { 
            position: fixed; 
            top: 50%; 
            right: 20px; 
            transform: translateY(-50%); 
            background: #28a745; 
            width: 60px; 
            height: 60px; 
            border-radius: 50%; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: 30px; 
            z-index: 1000; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }
        #createPostBtn:hover { 
            background: #218838; 
        }
        #postModal { 
            display: none; 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: rgba(0,0,0,0.5); 
            z-index: 2000; 
        }
        .modal-content { 
            background: white; 
            width: 400px; 
            margin: 100px auto; 
            padding: 20px; 
            border-radius: 8px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.2); 
        }
        .close { 
            float: right; 
            font-size: 20px; 
            cursor: pointer; 
            color: #FFA500; /* Orange for close button */
        }
        #menu { 
            position: absolute; /* Remove from flow to avoid pushing content */
            top: 50px; /* Below title (~30px height + 10px margin + buffer) */
            left: 50%; /* Start from center */
            width: 400px; /* Half of max-width 800px */
            background: #D3D3D3; /* Light gray background */
            padding: 7.5px 0; /* 3/4 of original 10px */
            border-top-left-radius: 10px; /* Curved top-left corner */
            border-bottom-right-radius: 10px; /* Curved bottom-right corner */
            border-top-right-radius: 0; /* Sharp top-right corner */
            border-bottom-left-radius: 0; /* Sharp bottom-left corner */
            display: flex; 
            justify-content: space-around; 
            z-index: 900; /* Below create button */
        }
        #menu a { 
            color: #000000; /* Black text for contrast */
            text-decoration: none; 
            padding: 7.5px 15px; /* 3/4 of original 10px vertically */
            font-weight: bold; 
            font-size: 14px; /* Base size */
            transition: font-size 0.2s ease; /* Smooth zoom transition */
        }
        #menu a:hover { 
            background: #B0B0B0; /* Slightly darker light gray on hover */
            border-radius: 4px; 
            font-size: 16px; /* Enlarged size on hover */
        }
        #searchInput { 
            width: 213px; /* 1/3 of original ~640px (80% of 800px) */
            margin-right: 5px; 
        }
        #searchButton { 
            width: auto; /* Adjust to content */
            padding: 10px; /* Smaller padding for compactness */
        }
        #mainContainer { 
            margin-top: 80px; /* Space for menu bar height (~30px) + buffer */
        }
    </style>
</head>
<body>
    <div id="app">
        <h1><span style="color: #000000;">Micro</span><span style="color: #FFFF00;">Post</span><span style="color: #000000; font-size: 0.7em;">.inc</span></h1>
        <div id="menu">
            <a href="#" onclick="alert('MENU 1 clicked')">MENU 1</a>
            <a href="#" onclick="alert('MENU 2 clicked')">MENU 2</a>
            <a href="#" onclick="alert('MENU 3 clicked')">MENU 3</a>
            <a href="#" onclick="alert('MENU 4 clicked')">MENU 4</a>
        </div>
        <div id="authContainer" class="container">
            <div id="registerForm">
                <h2>Register</h2>
                <div class="input-group">
                    <label>First Name</label>
                    <input id="firstName" placeholder="John">
                </div>
                <div class="input-group">
                    <label>Last Name</label>
                    <input id="lastName" placeholder="Doe">
                </div>
                <div class="input-group">
                    <label>Email</label>
                    <input id="regEmail" type="email" placeholder="john.doe@example.com">
                </div>
                <div class="input-group">
                    <label>Password</label>
                    <input id="regPassword" type="password" placeholder="••••••">
                </div>
                <button onclick="register()">Register</button>
                <p>Already have an account? <a href="#" onclick="showLogin()">Login</a></p>
            </div>
            <div id="loginForm" style="display: none;">
                <h2>Login</h2>
                <div class="input-group">
                    <label>Email</label>
                    <input id="loginEmail" type="email" placeholder="john.doe@example.com">
                </div>
                <div class="input-group">
                    <label>Password</label>
                    <input id="loginPassword" type="password" placeholder="••••••">
                </div>
                <button onclick="login()">Login</button>
                <p>No account? <a href="#" onclick="showRegister()">Register</a></p>
            </div>
        </div>
        <div id="mainContainer" class="container">
            <div class="input-group">
                <div style="display: flex;">
                    <input id="searchInput" placeholder="Search posts...">
                    <button id="searchButton" onclick="searchPosts()">Search</button>
                </div>
            </div>
            <div id="posts"></div>
        </div>
        <button id="createPostBtn" onclick="openPostModal()">+</button>
        <div id="postModal">
            <div class="modal-content">
                <span class="close" onclick="closePostModal()">×</span>
                <h2>Create Post</h2>
                <div class="input-group">
                    <label>Post (max 150 chars)</label>
                    <textarea id="postInput" maxlength="150" rows="3" placeholder="Write a post"></textarea>
                </div>
                <div class="input-group">
                    <label>Location</label>
                    <input id="locality" placeholder="Locality" style="width: 24%; margin-right: 1%;">
                    <input id="city" placeholder="City" style="width: 24%; margin-right: 1%;">
                    <input id="region" placeholder="Region" style="width: 24%; margin-right: 1%;">
                    <input id="country" placeholder="Country" style="width: 24%;">
                </div>
                <button onclick="submitPost()">Post ($1)</button>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js"></script>
    <!-- Stripe SDK -->
    <script src="https://js.stripe.com/v3/"></script>
    <script>
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_AUTH_DOMAIN",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_STORAGE_BUCKET",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const stripe = Stripe('pk_test_YOUR_PUBLISHABLE_KEY');

        // Load posts for all visitors
        loadPosts();

        // Auth state listener (only for post creation)
        auth.onAuthStateChanged(user => {
            if (user) {
                document.getElementById('createPostBtn').style.display = 'block';
            } else {
                document.getElementById('createPostBtn').style.display = 'block'; // Still visible, but requires login
            }
        });

        // Register
        async function register() {
            const firstName = document.getElementById('firstName').value;
            const lastName = document.getElementById('lastName').value;
            const email = document.getElementById('regEmail').value;
            const password = document.getElementById('regPassword').value;

            try {
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                await db.collection('users').doc(userCredential.user.uid).set({
                    firstName,
                    lastName,
                    email,
                });
                alert('Registration successful!');
                document.getElementById('authContainer').style.display = 'none';
            } catch (err) {
                alert('Error: ' + err.message);
            }
        }

        // Login
        async function login() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            try {
                await auth.signInWithEmailAndPassword(email, password);
                alert('Login successful!');
                document.getElementById('authContainer').style.display = 'none';
            } catch (err) {
                alert('Error: ' + err.message);
            }
        }

        // Open Post Modal
        function openPostModal() {
            if (!auth.currentUser) {
                document.getElementById('authContainer').style.display = 'block';
                document.getElementById('postModal').style.display = 'none';
            } else {
                document.getElementById('postModal').style.display = 'block';
            }
        }

        // Close Post Modal
        function closePostModal() {
            document.getElementById('postModal').style.display = 'none';
        }

        // Submit Post
        async function submitPost() {
            const content = document.getElementById('postInput').value;
            const locality = document.getElementById('locality').value;
            const city = document.getElementById('city').value;
            const region = document.getElementById('region').value;
            const country = document.getElementById('country').value;

            if (content.length > 150) {
                alert("Post must be 150 characters or less!");
                return;
            }
            if (!content.trim()) return;

            const user = auth.currentUser;
            const postRef = await db.collection("posts").add({
                content,
                timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                status: 'pending',
                location: { locality, city, region, country },
                userId: user.uid,
            });

            const response = await fetch('https://YOUR_REGION-YOUR_PROJECT_ID.cloudfunctions.net/createCheckoutSession', {
                method: 'POST',
                headers: { 
                    'Content-Type': 'application/json', 
                    'Authorization': `Bearer ${await auth.currentUser.getIdToken()}` 
                },
                body: JSON.stringify({ postId: postRef.id })
            });
            const { sessionId } = await response.json();
            stripe.redirectToCheckout({ sessionId });
        }

        // Display Posts
        function displayPosts(posts) {
            const postsDiv = document.getElementById('posts');
            postsDiv.innerHTML = '';
            posts.forEach(post => {
                const div = document.createElement('div');
                div.className = 'post';
                div.innerHTML = `${post.content}<br><span class="location">${post.location.locality}, ${post.location.city}, ${post.location.region}, ${post.location.country}</span>`;
                postsDiv.appendChild(div);
            });
        }

        // Load Posts
        function loadPosts() {
            db.collection("posts")
                .where("status", "==", "visible")
                .orderBy("timestamp", "desc")
                .onSnapshot((snapshot) => {
                    const posts = snapshot.docs.map(doc => doc.data());
                    displayPosts(posts);
                });
        }

        // Search Posts
        async function searchPosts() {
            const query = document.getElementById('searchInput').value;
            if (!query) {
                loadPosts();
                return;
            }

            const response = await fetch(`https://YOUR_REGION-YOUR_PROJECT_ID.cloudfunctions.net/searchPosts?query=${encodeURIComponent(query)}`);
            const filteredPosts = await response.json();
            displayPosts(filteredPosts);
        }
    </script>
</body>
</html>
